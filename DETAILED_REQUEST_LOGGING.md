# 详细请求日志 - 完整的调试信息

## 改进内容
添加详细的请求数据日志，包括：
- 请求参数
- 数据库查询结果
- 物理文件路径信息
- 每个步骤的执行结果

## 日志输出示例

### 成功的文件移动操作

```
=== 文件移动请求开始 ===
用户: admin
源文件夹ID: 1
文件名: test_1234567890.txt
目标文件夹ID: 2
源文件夹查询结果: 存在 (源文件夹)
源文件夹权限检查: 有权限
目标文件夹查询结果: 存在 (目标文件夹)
目标文件夹权限检查: 有权限
查询文件: savedName=test_1234567890.txt, folderId=1
文件查询结果: 找到 (ID=1, originalName=test.txt)
物理路径信息:
  FILES_ROOT: /path/to/files
  源文件夹物理路径: admin/1234567890
  目标文件夹物理路径: admin/1234567891
  文件savedName: test_1234567890.txt
  源文件完整路径: /path/to/files/admin/1234567890/test_1234567890.txt
  目标文件完整路径: /path/to/files/admin/1234567891/test_1234567890.txt
源文件是否存在: true
创建目标目录: /path/to/files/admin/1234567891
物理文件移动成功: /path/to/files/admin/1234567890/test_1234567890.txt -> /path/to/files/admin/1234567891/test_1234567890.txt
数据库更新成功: 文件ID=1, 新文件夹ID=2
=== 文件移动成功 ===
文件: test.txt (savedName: test_1234567890.txt)
从: 源文件夹 (ID: 1)
到: 目标文件夹 (ID: 2)
数据库已更新: 文件ID=1, 新文件夹ID=2
```

### 失败的文件移动操作（文件不存在）

```
=== 文件移动请求开始 ===
用户: admin
源文件夹ID: 1
文件名: nonexistent_1234567890.txt
目标文件夹ID: 2
源文件夹查询结果: 存在 (源文件夹)
源文件夹权限检查: 有权限
目标文件夹查询结果: 存在 (目标文件夹)
目标文件夹权限检查: 有权限
查询文件: savedName=nonexistent_1234567890.txt, folderId=1
文件查询结果: 未找到
文件不存在: savedName=nonexistent_1234567890.txt, folderId=1
```

### 失败的文件移动操作（物理文件不存在）

```
=== 文件移动请求开始 ===
用户: admin
源文件夹ID: 1
文件名: test_1234567890.txt
目标文件夹ID: 2
源文件夹查询结果: 存在 (源文件夹)
源文件夹权限检查: 有权限
目标文件夹查询结果: 存在 (目标文件夹)
目标文件夹权限检查: 有权限
查询文件: savedName=test_1234567890.txt, folderId=1
文件查询结果: 找到 (ID=1, originalName=test.txt)
物理路径信息:
  FILES_ROOT: /path/to/files
  源文件夹物理路径: admin/1234567890
  目标文件夹物理路径: admin/1234567891
  文件savedName: test_1234567890.txt
  源文件完整路径: /path/to/files/admin/1234567890/test_1234567890.txt
  目标文件完整路径: /path/to/files/admin/1234567891/test_1234567890.txt
源文件是否存在: false
源文件物理路径不存在: /path/to/files/admin/1234567890/test_1234567890.txt
```

## 日志级别

| 级别 | 用途 | 示例 |
|------|------|------|
| `info` | 正常的操作流程 | 请求开始、查询结果、操作成功 |
| `warn` | 警告信息 | 缺少参数 |
| `error` | 错误信息 | 文件不存在、权限不足、操作失败 |

## 调试步骤

### 1. 重启后端服务器
```bash
cd backend
npm start
```

### 2. 在前端执行文件移动操作

### 3. 查看后端控制台输出
观察日志输出，找出问题所在：

- **如果看到 "源文件是否存在: false"** → 物理文件不存在
  - 检查 FILES_ROOT 是否正确
  - 检查源文件夹物理路径是否正确
  - 检查文件是否真的存在

- **如果看到 "文件查询结果: 未找到"** → 数据库中没有该文件
  - 检查 savedName 是否正确
  - 检查 folderId 是否正确

- **如果看到 "无权访问源文件夹"** → 权限问题
  - 检查用户是否是文件夹的所有者
  - 检查是否有共享权限

## 修改的文件

| 文件 | 修改 | 状态 |
|------|------|------|
| `backend/src/routes/folderRoutes.js` | 添加详细请求日志 | ✅ 完成 |

## 完成状态

✅ **请求参数日志** - 打印所有输入参数
✅ **数据库查询日志** - 打印查询结果
✅ **物理路径日志** - 打印完整的文件路径
✅ **步骤执行日志** - 打印每个步骤的结果
✅ **错误日志** - 打印详细的错误信息

**现在重启后端服务器，查看详细的日志输出来诊断问题！**

## 相关文档

- `MOVE_FILE_DEBUG_LOGGING.md` - 错误处理和日志记录
- `ERROR_CODE_OPTIMIZATION.md` - 错误码优化说明
